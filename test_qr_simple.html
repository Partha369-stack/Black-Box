<!DOCTYPE html>
<html>
<head>
    <title>QR Code Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .qr-display { margin: 20px 0; text-align: center; }
        .qr-display img { max-width: 300px; border: 1px solid #ccc; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üéØ QR Code Generation Test</h1>
    
    <div class="test-section">
        <h2>Test Order Creation & QR Generation</h2>
        <button onclick="testQRGeneration()">Create Test Order & Generate QR</button>
        
        <div id="logs" class="log"></div>
        
        <div id="qrDisplay" class="qr-display"></div>
    </div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        async function testQRGeneration() {
            log('üß™ Starting QR generation test...');
            
            const testOrder = {
                items: [{ id: '1', name: 'Test Product', price: 25, quantity: 1 }],
                totalAmount: 25,
                customerName: 'Test Customer',
                customerPhone: '9876543210'
            };
            
            try {
                log('üì§ Sending order creation request...');
                
                const response = await fetch('https://black-box-production.up.railway.app/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Tenant-ID': 'VM-001'
                    },
                    body: JSON.stringify(testOrder)
                });
                
                log(`üì• Response status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Order created: ${data.orderId}`);
                    log(`üéØ QR Code URL: ${data.qrCodeUrl}`);
                    log(`üÜî QR Code ID: ${data.qrCodeId}`);
                    log(`üí≥ Razorpay Order ID: ${data.razorpayOrderId}`);
                    
                    // Display QR code
                    const qrDisplay = document.getElementById('qrDisplay');
                    if (data.qrCodeUrl) {
                        if (data.qrCodeUrl.includes('razorpay')) {
                            log('‚úÖ Real Razorpay QR code detected!');
                        } else {
                            log('‚ö†Ô∏è Placeholder QR code detected');
                        }
                        
                        qrDisplay.innerHTML = `
                            <h3>Generated QR Code:</h3>
                            <img src="${data.qrCodeUrl}" alt="QR Code" onload="log('üñºÔ∏è QR image loaded successfully')" onerror="log('‚ùå QR image failed to load')" />
                            <p>QR Code ID: ${data.qrCodeId}</p>
                        `;
                    }
                    
                } else {
                    const errorText = await response.text();
                    log(`‚ùå Order creation failed: ${errorText}`);
                }
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>
